<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Budget Buddy</title>
  <!-- Using updated Font Awesome CDN with integrity -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" 
    integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" 
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />
  <link rel="icon" href="./CashFlow-removebg-preview.png" />
  <style>
    /* Piggy Bank Animation - DO NOT CHANGE */
    .piggy-container {
      position: fixed;
      bottom: 20px;
      left: 20px;
      z-index: 1000;
    }
    .piggy-bank {
      font-size: 40px;
      color: #ff69b4;
      cursor: pointer;
      transition: transform 0.3s ease;
    }
    @keyframes wiggle {
      0% { transform: rotate(0deg); }
      25% { transform: rotate(15deg); }
      50% { transform: rotate(-15deg); }
      75% { transform: rotate(10deg); }
      100% { transform: rotate(0deg); }
    }
    .wiggle {
      animation: wiggle 0.5s ease-in-out;
    }

    /* General Reset and Layout */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(0deg, #FFDEE9 0%, #B5FFFC 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      color: #333;
    }
    .container {
      width: 100%;
      max-width: 900px;
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      padding: 32px;
    }
    .main-div {
      overflow-y: auto;
      max-height: 600px;
    }

    /* Header and Navigation */
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }
    .logo {
      font-size: 24px;
      font-weight: 600;
      color: #007bff;
    }
    .nav-links {
      list-style-type: none;
      display: flex;
      gap: 16px;
    }
    .nav-links li {
      font-size: 14px;
      color: black;
      cursor: pointer;
    }
    .nav-links li a {
      text-decoration: none;
      color: inherit;
    }
    .btn-add {
      background-color: #007bff;
      color: white;
      padding: 8px 16px;
      border-radius: 4px;
      text-decoration: none;
      cursor: pointer;
    }

    /* Budget Container */
    .budget-container {
      margin-bottom: 32px;
    }
    .title {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 8px;
    }
    .subtitle {
      font-size: 16px;
      color: #6c757d;
      margin-bottom: 16px;
    }
    .budget-input {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    .budget-input input {
      width: 80%;
      padding: 8px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    .amount {
      font-size: 16px;
      font-weight: 500;
    }
    .set-budget-btn {
      background-color: #28a745;
      color: white;
      padding: 12px 24px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      width: 100%;
      margin-top: 16px;
    }
    .set-budget-btn:hover {
      background-color: #218838;
    }

    /* Progress Bar */
    .progress-bar {
      position: relative;
      width: 100%;
      height: 8px;
      background-color: #f1f1f1;
      border-radius: 4px;
      margin: 16px 0;
    }
    .progress-bar-fill {
      height: 100%;
      background-color: #007bff;
      border-radius: 4px;
      width: 0;
    }

    /* Suggested Budget */
    .suggested-budget {
      margin-bottom: 24px;
    }
    .budget-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid #f1f1f1;
    }
    .budget-item:last-child {
      border-bottom: none;
    }
    .budget-item .amount {
      font-weight: 500;
    }

    /* Transaction Form and List */
    .form-container {
      display: none;
      margin-top: 24px;
      padding: 16px;
      background-color: #f9f9f9;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    .form-container input {
      margin-bottom: 8px;
      width: 100%;
      padding: 8px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .form-container button {
      background-color: #007bff;
      color: white;
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      width: 100%;
    }
    .form-container button:hover {
      background-color: #0056b3;
    }
    .transaction-list {
      margin-top: 24px;
    }
    .transaction-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid #f1f1f1;
    }
    .transaction-item:last-child {
      border-bottom: none;
    }
    .transaction-item .amount {
      font-weight: 500;
    }

    /* Return to Top Button */
    .btn-top {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #007bff;
      color: white;
      padding: 8px 16px;
      border-radius: 50%;
      display: none;
      cursor: pointer;
    }
    .btn-top:hover {
      background-color: #0056b3;
    }

    /* Chatbot Styles */
    .chatbot-container {
      position: fixed;
      bottom: 80px;
      right: 20px;
      width: 300px;
      max-height: 400px;
      background-color: #fff;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      z-index: 1000;
    }
    .chatbot-header {
      background-color: #007bff;
      color: white;
      padding: 10px;
      border-top-left-radius: 8px;
      border-top-right-radius: 8px;
      cursor: pointer;
    }
    .chatbot-messages {
      flex: 1;
      padding: 10px;
      overflow-y: auto;
      display: block;
    }
    .chatbot-input-container {
      display: flex;
      border-top: 1px solid #ccc;
    }
    .chatbot-input-container input {
      flex: 1;
      border: none;
      padding: 10px;
      font-size: 14px;
    }
    .chatbot-input-container button {
      background-color: #007bff;
      border: none;
      color: white;
      padding: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <!-- Piggy Bank Animation (kept unchanged) -->
  <div class="piggy-container">
    <i class="fa-solid fa-piggy-bank piggy-bank" id="piggyBank"></i>
  </div>

  <div class="container">
    <!-- Header Section -->
    <header>
      <div class="logo">Cashflow</div>
      <ul class="nav-links">
        <li class="dashboard"><a href="./dashboard.html">Dashboard</a></li>
        <li class="transaction"><a href="transaction.html">Transactions</a></li>
        <li class="goals"><a href="./goal.html">Goals</a></li>
      </ul>
      <a href="#" class="btn-add" onclick="toggleTransactionForm()">Add Transaction</a>
    </header>

    <div class="main-div">
      <!-- Budget Container -->
      <div class="budget-container">
        <div class="title">Set up your budget</div>
        <div class="subtitle">Let’s make sure you’re not spending more than you planned.</div>
        
        <!-- Budget Input Section -->
        <div class="budget-input">
          <input type="number" id="budget" placeholder="Set your budget" value="0" />
          <div class="amount">Remaining: <span id="remaining">₹0</span></div>
        </div>
        
        <!-- Progress Bar -->
        <div class="progress-bar">
          <div class="progress-bar-fill" id="progress-bar"></div>
        </div>

        <!-- Suggested Budget Section -->
        <div class="suggested-budget">
          <div class="title">Suggested budget based on past expenses</div>
          <div class="budget-item">
            <span><i class="fa-solid fa-car-side"></i> Auto</span>
            <span class="amount">₹100</span>
          </div>
          <div class="budget-item">
            <span><i class="fa-solid fa-bowl-food"></i> Food</span>
            <span class="amount">₹500</span>
          </div>
          <div class="budget-item">
            <span><i class="fa-solid fa-house-chimney"></i> Rent</span>
            <span class="amount">₹1000</span>
          </div>
          <div class="budget-item">
            <span><i class="fa-solid fa-compass"></i> Travel</span>
            <span class="amount">₹1000</span>
          </div>
          <div class="budget-item">
            <span><i class="fa-solid fa-video"></i> Entertainment</span>
            <span class="amount">₹600</span>
          </div>
          <div class="budget-item">
            <span><i class="fa-solid fa-cart-shopping"></i> Groceries</span>
            <span class="amount">₹500</span>
          </div>
        </div>

        <!-- Set Budget Button -->
        <button class="set-budget-btn" onclick="setBudget()">Set Budget</button>
      </div>

      <!-- Transaction Form (hidden by default) -->
      <div class="form-container" id="transaction-form">
        <div class="title">Add a Transaction</div>
        <input type="text" id="transaction-category" placeholder="Category" required />
        <input type="number" id="transaction-amount" placeholder="Amount" required />
        <input type="text" id="transaction-description" placeholder="Description" required />
        <button onclick="addTransaction()">Add Transaction</button>
      </div>

      <!-- Transaction List -->
      <div class="transaction-list" id="transaction-list">
        <div class="title">Transaction List</div>
        <!-- Transactions will appear here -->
      </div>
    </div>
  </div>

  <!-- Return to Top Button -->
  <button class="btn-top" id="returnToTop" onclick="scrollToTop()">↑</button>

  <!-- Chatbot Container -->
  <div class="chatbot-container" id="chatbotContainer">
    <div class="chatbot-header" onclick="toggleChatbot()">Chat with Budget Buddy AI</div>
    <div class="chatbot-messages" id="chatbotMessages">
      <!-- Chat messages will appear here -->
    </div>
    <div class="chatbot-input-container">
      <input type="text" id="chatbotInput" placeholder="Type your message here..." />
      <button onclick="sendChatMessage()">Send</button>
    </div>
  </div>

  <script>
    let currentBudget = 1500; // Default starting budget
    let transactions = JSON.parse(localStorage.getItem('transactions')) || [];

    // Update Budget Function
    function setBudget() {
      const budgetInput = document.getElementById('budget');
      const remaining = document.getElementById('remaining');
      const progressBarFill = document.getElementById('progress-bar');
      
      currentBudget = parseInt(budgetInput.value) || 0;
      remaining.innerText = `₹${currentBudget}`;
      
      // For simplicity, progress is set to 100% (can be modified to show actual spending progress)
      const progress = (currentBudget / currentBudget) * 100;
      progressBarFill.style.width = progress + '%';
    }

    // Toggle the visibility of the transaction form
    function toggleTransactionForm() {
      const form = document.getElementById('transaction-form');
      form.style.display = form.style.display === 'none' || form.style.display === '' ? 'block' : 'none';
    }

    // Add Transaction Function
    function addTransaction() {
      const category = document.getElementById('transaction-category').value;
      const amount = parseInt(document.getElementById('transaction-amount').value);
      const description = document.getElementById('transaction-description').value;
      const date = new Date().toLocaleDateString();

      if (category && amount && description) {
        if (amount > currentBudget) {
          alert("You do not have enough budget to add this transaction.");
          return;
        }
        
        // Deduct amount from the budget
        currentBudget -= amount;
        document.getElementById('remaining').innerText = `₹${currentBudget}`;
        
        // Trigger Piggy Bank Animation
        const piggy = document.getElementById('piggyBank');
        piggy.classList.add('wiggle');
        setTimeout(() => { piggy.classList.remove('wiggle'); }, 500);
        
        // Create and store the transaction
        const transaction = { category, amount, description, date };
        transactions.push(transaction);
        localStorage.setItem('transactions', JSON.stringify(transactions));
        
        // Display the new transaction
        const transactionList = document.getElementById('transaction-list');
        const transactionItem = document.createElement('div');
        transactionItem.classList.add('transaction-item');
        transactionItem.innerHTML = `<span>${category}: ${description} <br><span class="amount">(₹${amount})</span> <span class="date">${date}</span></span>`;
        transactionList.appendChild(transactionItem);
        
        // Clear the form inputs and hide the form
        document.getElementById('transaction-category').value = '';
        document.getElementById('transaction-amount').value = '';
        document.getElementById('transaction-description').value = '';
        toggleTransactionForm();
      } else {
        alert('Please fill out all fields.');
      }
    }

    // Show/hide the "Return to Top" button based on scroll position
    window.onscroll = function () {
      const btnTop = document.getElementById('returnToTop');
      if (document.body.scrollTop > 100 || document.documentElement.scrollTop > 100) {
        btnTop.style.display = 'block';
      } else {
        btnTop.style.display = 'none';
      }
    };

    // Scroll back to the top of the page
    function scrollToTop() {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // Chatbot Functions

    // Toggle chatbot UI visibility
    function toggleChatbot() {
      const messages = document.getElementById('chatbotMessages');
      const inputContainer = document.querySelector('.chatbot-input-container');
      if (messages.style.display === 'none' || messages.style.display === '') {
        messages.style.display = 'block';
        inputContainer.style.display = 'flex';
      } else {
        messages.style.display = 'none';
        inputContainer.style.display = 'none';
      }
    }

    // Send chat message and call the chat completions API
    function sendChatMessage() {
      const input = document.getElementById('chatbotInput');
      const messagesContainer = document.getElementById('chatbotMessages');
      const message = input.value.trim();
      if (message === '') return;

      // Append user's message
      const userMessageDiv = document.createElement('div');
      userMessageDiv.textContent = "You: " + message;
      messagesContainer.appendChild(userMessageDiv);
      input.value = '';

      // Call the chat completions API with the user's message
      callChatCompletionsAPI(message);
    }

    // Call the chat completions API using fetch
    function callChatCompletionsAPI(userMessage) {
      const url = "https://api.x.ai/v1/chat/completions";
      const payload = {
        messages: [
          {
            role: "system",
            content: "You are a test assistant."
          },
          {
            role: "user",
            content: userMessage || "Testing. Just say hi and hello world and nothing else."
          }
        ],
        model: "grok-2-latest",
        stream: false,
        temperature: 0
      };

      fetch(url, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": "Bearer xai-MydU63ce7gV2AvWSsxxkQVJKsBWMUKU0kyqJPoa6W5VJjmVRT9928UNoOIYRqYGmwO2BvIYfdc8wfAFF"
        },
        body: JSON.stringify(payload)
      })
      .then(response => response.json())
      .then(data => {
        console.log("API response:", data);
        if (data && data.choices && data.choices.length > 0) {
          const aiReply = data.choices[0].message.content;
          displayAIResponse(aiReply);
        } else {
          displayAIResponse("Sorry, no valid response received.");
        }
      })
      .catch(error => {
        console.error("Error calling API:", error);
        displayAIResponse("Error calling the API.");
      });
    }

    // Append AI response to the chatbot messages container
    function displayAIResponse(responseText) {
      const messagesContainer = document.getElementById('chatbotMessages');
      const aiMessageDiv = document.createElement('div');
      aiMessageDiv.textContent = "Budget Buddy AI: " + responseText;
      messagesContainer.appendChild(aiMessageDiv);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }
  </script>
</body>
</html>
